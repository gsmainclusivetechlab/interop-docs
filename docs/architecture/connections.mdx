---
id: connections
title: How Components Connections Works
sidebar_label: Component Connections
---

This page describes how the various components of the Interoperability Testing
Platform (ITP) work together, and how they can be deployed to different
environments.

## Connections between Components

In normal operation, the payer's MMO would connect directly to Mojaloop to
arrange a funds transfer to the payee's MMO. In testing, however, we must
inspect every message to validate that they are correctly formed. To achieve
this, the ITP acts as a transparent proxy between all components. By configuring
endpoint URLs within component A to point at the ITP instead of directly to
component B, the ITP can store all messages and forward them onto component B.

import { Graphviz } from "graphviz-react";

<Graphviz
  options={{ height: "auto" }}
  dot={`
    digraph {
      rankdir="TD"
      ratio="fill";
      size="6,2";
      sp [ label="SP" shape="box"]
      mmo1 [ label="MMO1" shape="box"]
      mojaloop [ label="Mojaloop" shape="box"]
      mmo2 [ label="MMO2" shape="box"]
      ITP [ label="Test Platform" shape="box"]
      subgraph sim {
        rank="same"
        sp -> mmo1 -> sp [ style="dashed", color="#67ab9f"]
        mmo1 -> mojaloop -> mmo2 -> mojaloop -> mmo1 [ style="dashed", nodesep=1]
      }
      ITP -> {sp mmo1} [dir="both", color="#67ab9f"]
      ITP -> {mmo1 mojaloop mmo2} [dir="both"]
    }
`}
/>
<Graphviz
  options={{ height: "auto" }}
  dot={`
      digraph {
        size="6,2";
        rankdir="LR"
        a [style=invis];
        b [style=invis] ;
        c [style=invis] ;
        d [style=invis] ;
        e [style=invis] ;
        f [style=invis] ;
        a -> b [label="Actual message (MM API)", color="#67ab9f"] ;
        b -> f [label="Actual message (Mojaloop API)"] ;
        c -> d [label="Logical message (MM API)", style=dashed, color="#67ab9f"];
        d -> e [label="Logical message (Mojaloop API)", style=dashed] ;
      }
`}
/>

## Component URLs

In order to recognise the sender and intended recipient of each message received
by the test platform, this information must be embedded within the message.
Specifically, the test platform expects that the base URL for each request will
contain a UUID corresponding to both the sender and intended recipients of the
message. Normally, the test platform will insert these UUIDs transparently so
that it is not necessary to know which component corresponds to which UUID, but
it can be helpful for debugging to know which UUID is which:

- **SP**: 114511be-74e9-49d5-b93e-b4a461e01626
- **MMO1**: e5f5e817-94d6-4a43-a7ec-f7274b6d85c2
- **Mojaloop**: b2a85076-b748-4d93-8df1-2b39844e6d4b
- **MMO2**: e602a859-a25f-4d37-9abe-0ac09fb734af

### SUT URLs

Within a SUT, the base URL of each component should be configured according to
the following scheme:

```
https://{itp_url}/testing/{session_uuid}/{my_uuid}/{recipient_uuid}/sut/
```

The `session_uuid` corresponds to a unique ID for each testing session, and
helps the test platform to validate incoming messages to ensure that the
expected test-cases are being correctly matched. `itp_url` is the base URL of
the test platform (e.g. `interop.gsmainclusivetechlab.io`). `my_uuid` is the
UUID of the component which is being tested, and `recipient_uuid` is the UUID of
the component to which the request will be made.

Thus, the URL that an MMO1 test subject should use to send messages to Mojaloop
(through the test platform) would be:

```
https://interop.gsmainclusivetechlab.io/testing/41a2e8d5-3ce4-459b-a6eb-1a1e2988c357/e5f5e817-94d6-4a43-a7ec-f7274b6d85c2/b2a85076-b748-4d93-8df1-2b39844e6d4b/sut/
```

### TODO: Do we need the simulator URL documentation here?

It feels like it's not useful for a normal user who wouldn't be configuring the
simulators anyway. It might be useful in a separate "deployment" guide.

### Simulator URLs

Since the simulators are within the control of the test platform, we can
slightly simplify the request URLs compared to SUTs. In particular, the
simulators use a `traceparent` header in place of the `session_uuid` from above.
For this reason base URLs used by each simulator have this structure.

```
https://{itp_url}/testing/{my_uuid}/{recipient_uuid}/simulator/
```

Thus, the URL that an MMO1 simulator should use to send messages to Mojaloop
(through the test platform) would be:

```
https://interop.gsmainclusivetechlab.io/testing/e5f5e817-94d6-4a43-a7ec-f7274b6d85c2/b2a85076-b748-4d93-8df1-2b39844e6d4b/simulator/
```
