"use strict";(self.webpackChunkinterop_docs=self.webpackChunkinterop_docs||[]).push([[79],{1422:function(e,t,s){s.r(t),s.d(t,{assets:function(){return d},contentTitle:function(){return r},default:function(){return h},frontMatter:function(){return l},metadata:function(){return a},toc:function(){return o}});var n=s(5893),i=s(1151);const l={title:"Test Case Template",sidebar_label:"Test Case Template"},r=void 0,a={id:"testcases/template-tc",title:"Test Case Template",description:"The ITP test cases are defined using YAML files. Each file is composed of",source:"@site/docs/testcases/template-tc.md",sourceDirName:"testcases",slug:"/testcases/template-tc",permalink:"/testcases/template-tc",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Test Case Template",sidebar_label:"Test Case Template"},sidebar:"someSidebar",previous:{title:"List of Test Cases",permalink:"/testcases/tclist"},next:{title:"Creating a Test Case",permalink:"/testcases/creating-tc"}},d={},o=[{value:"Test Case Information",id:"test-case-information",level:2},{value:"Example of test case information in a YAML file",id:"example-of-test-case-information-in-a-yaml-file",level:4},{value:"Test Case Components",id:"test-case-components",level:3},{value:"Test Steps",id:"test-steps",level:2},{value:"Example of test steps",id:"example-of-test-steps",level:4},{value:"Assertions (<code>test_request_scripts</code> and <code>test_response_scripts</code>)",id:"assertions-test_request_scripts-and-test_response_scripts",level:3},{value:"Request and Response Templates",id:"request-and-response-templates",level:3},{value:"Example of a request and response",id:"example-of-a-request-and-response",level:4},{value:"JWS Signatures",id:"jws-signatures",level:3},{value:"Repeating Requests",id:"repeating-requests",level:2},{value:"Template variables",id:"template-variables",level:2},{value:"<code>env</code>",id:"env",level:4},{value:"<code>steps</code>",id:"steps",level:4},{value:"<code>uuidv4</code>",id:"uuidv4",level:4},{value:"<code>&quot;now&quot;</code>",id:"now",level:4},{value:"<code>mapped_urls</code>",id:"mapped_urls",level:4},{value:"ILP Functions",id:"ilp-functions",level:4}];function c(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"The ITP test cases are defined using YAML files. Each file is composed of\nseveral fields which define both the validations to perform during a test as\nwell as the behaviour of any simulated components. This page describes the basic\nstructure of a YAML file for the test platform."}),"\n",(0,n.jsx)(t.h2,{id:"test-case-information",children:"Test Case Information"}),"\n",(0,n.jsx)(t.p,{children:"Every test case YAML file begins with the same basic information. Six fields are\nused as a header to specify particular characteristics related to the test case\nand the use case it belongs to. Below you can see a table with the fields used\nin the header and an example of the test case data in a YAML file."}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{children:"Example"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"name"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The name of the Test Case that will be shown to users."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"Authorized Transaction by Payer FSP"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"slug"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A unique name for the test case, used internally."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"authorized-transaction"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"use_case"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The name of the Use Case that the test case case is related to. This should be identical for all Test Cases sharing a Use Case."}),(0,n.jsx)(t.td,{})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"behavior"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:['Defines the type of the Test Case, i.e. "Happy flow" (',(0,n.jsx)(t.code,{children:"positive"}),') and "Unhappy flow" (',(0,n.jsx)(t.code,{children:"negative"}),")."]}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"positive"})}),(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"negative"})})]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"description"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A description of the Test Case. It is useful to include some business background of what we are trying to achieve in this case."}),(0,n.jsx)(t.td,{children:"The Service Provider wants to test if he is capable of receiving a transaction from a different wallet..."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"precondition"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["An additional area describing specific values that should be used to execute a Test Case. This may include directions for using test case ",(0,n.jsx)(t.a,{href:"/architecture/matching",children:"triggers"}),"."]}),(0,n.jsx)(t.td,{})]})]})]}),"\n",(0,n.jsx)(t.h4,{id:"example-of-test-case-information-in-a-yaml-file",children:"Example of test case information in a YAML file"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'name: Authorized Transaction by Payer FSP\nslug: authorized-transaction\nuse_case: Merchant-Initiated Merchant Payment\nbehavior: positive\ndescription: |\n  The Service Provider wants to test if he is capable of receiving a\n  transaction from a different wallet provider than the one with which he has\n  an account. In this case, we simulate the scenario when the Payer would\n  like to buy goods or services from a Service Provider (the Payee), but each\n  of them uses different wallet providers. This flow shows the necessary\n  steps for this transaction simulating an approved transaction.\nprecondition: |\n  - Service Provider has GSMA Mobile Money API Implemented.\n  - Service Provider is capable of handling async calls.\n  - Payee and Payer MMOs exist in Mojaloop as Participants.\n  - Payee and Payer exist in Mojaloop as Parties.\n  - Amount should be the value "1001".\n  - Debit party should be identified by account identifier "msisdn" with the value "+33555123456".\n  - Credit party should be identified by account identifier "msisdn" with the value "+33555789123".\n'})}),"\n",(0,n.jsx)(t.h3,{id:"test-case-components",children:"Test Case Components"}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"components"})," field defines the components which are used in the test case.\nEach component is defined by:"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{children:"Example"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"name"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The readable name of the component that will be shown to users."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"Service Provider"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"slug"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["A short unique name for the component, which will be used elsewhere in the file and in ",(0,n.jsx)(t.a,{href:"../architecture/connections",children:"component URLs"}),"."]}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"sp"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"versions"})," (optional)"]}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The versions of a component for which this test case should be used."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"[v1, v2]"})})]})]})]}),"\n",(0,n.jsx)(t.p,{children:"Although the name, slug and versions field are free to be any values, it is\ngenerally a good idea to keep the values consistent across multiple test cases.\nThis ensures that identical components are correctly grouped in component\ndiagrams, for example."}),"\n",(0,n.jsxs)(t.p,{children:["Component versions can be useful in the situation that the test platform wants\nto test multiple versions of a component at once. For example, one may wish to\ntest a behaviour which exists in ",(0,n.jsx)(t.code,{children:"v1"})," of a system, but is deprecated in ",(0,n.jsx)(t.code,{children:"v2"})," and\n",(0,n.jsx)(t.code,{children:"v3"}),". In this case, two test cases should be created - with the version field\nset appropriately in both. If the behaviour examined by a test case does not\ndiffer based on component versions, then the version field may be omitted, and\nthe test case will be used for any component version."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"# ... test case information\ncomponents:\n  - name: Service Provider\n    slug: service-provider\n    versions:\n      - v2\n      - v3\n  - name: Mojaloop\n    slug: mojaloop\n  - name: Mobile Money Operator 1\n    slug: mmo1\n  - name: Mobile Money Operator 2\n    slug: mmo2\n"})}),"\n",(0,n.jsx)(t.h2,{id:"test-steps",children:"Test Steps"}),"\n",(0,n.jsxs)(t.p,{children:["The remainder of the test case file is made up of a list of ",(0,n.jsx)(t.em,{children:"test steps"}),". Each\nstep represents an HTTP request made as part of the test, and is defined by the\nfollowing values:"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{children:"Example"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"source"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The sender of the request. Should be a slug from the ",(0,n.jsx)(t.code,{children:"components"})," section of the test case. Will be used to ",(0,n.jsx)(t.a,{href:"/architecture/matching",children:"match incoming requests"})]}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"sp"})}),(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"mmo-1"})}),(0,n.jsx)("li",{children:"etc."})]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"target"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The recipient of the request. Should be a slug from the ",(0,n.jsx)(t.code,{children:"components"})," section of the test case. Will be used to ",(0,n.jsx)(t.a,{href:"/architecture/matching",children:"match incoming requests"})]}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"sp"})}),(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"mmo-1"})}),(0,n.jsx)("li",{children:"etc."})]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"method"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The request method that will be used to ",(0,n.jsx)(t.a,{href:"/architecture/matching",children:"match incoming requests"}),"."]}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"POST"})}),(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"PUT"})}),(0,n.jsx)("li",{children:"etc."})]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"pattern"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["A regular expression that will be used to ",(0,n.jsx)(t.a,{href:"/architecture/matching",children:"match incoming requests"})," using the request path."]}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"^transactionRequests\\$"})}),(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"^quotes/[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}\\$"})}),(0,n.jsx)("li",{children:"etc."})]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"trigger"})}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["A JSON value that will be compared against incoming request bodies for ",(0,n.jsx)(t.a,{href:"/architecture/matching",children:"matching"}),"."]}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"{amount: '99'}"})}),(0,n.jsx)("li",{children:"etc."})]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"api_spec"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The API spec to perform automated schema validation. Should be a specification name from the database."}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"Mojaloop v1.0"}),(0,n.jsx)("li",{children:"MM v1.1.2"}),(0,n.jsx)("li",{children:"etc."})]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"path"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A path defined inside the API spec, which is used to lookup schema validation rules. Also used as a label for the step."}),(0,n.jsx)(t.td,{children:(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"/quotes/{ID}"})}),(0,n.jsx)("li",{children:(0,n.jsx)(t.code,{children:"/transactionRequests"})}),(0,n.jsx)("li",{children:"etc."})]})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"mtls"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A boolean indicating whether an mTLS connection is required to execute this test step"}),(0,n.jsxs)(t.td,{children:[(0,n.jsx)(t.code,{children:"true"})," or ",(0,n.jsx)(t.code,{children:"false"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"test_request_scripts"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A list of business rule assertions that will be performed on the request."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.em,{children:"see below"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"test_response_scripts"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A list of business rule assertions that will be performed on the HTTP response."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.em,{children:"see below"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"request"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A template HTTP request which will be used to generate test requests from a simulator."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.em,{children:"see below"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"response"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A template HTTP response which will be used to generate test responses from a simulator."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.em,{children:"see below"})})]})]})]}),"\n",(0,n.jsx)(t.h4,{id:"example-of-test-steps",children:"Example of test steps"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'test_steps:\n  # Step 1. Mobile Money Operator 2 -> Mojaloop\n  - source: mmo-2\n    target: mojaloop\n    method: PUT\n    pattern: "^quotes/[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"\n    trigger:\n      transferAmount:\n        amount: "99"\n    api_spec: Mojaloop v1.0\n    path: /quotes/{ID}\n    test_request_scripts: # ...\n    test_response_scripts: # ...\n    request: # ...\n    response: # ...\n\n  # Step 2. Mobile Money Operator 1 -> Mojaloop\n  - source: mmo-1\n    target: mojaloop\n    method: PUT\n    pattern: "^quotes/[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"\n    trigger:\n      transferAmount:\n        amount: "99"\n    api_spec: Mojaloop v1.0\n    path: /quotes/{ID}\n    test_request_scripts: # ...\n    test_response_scripts: # ...\n    request: # ...\n    response: # ...\n\n\n  # ...\n'})}),"\n",(0,n.jsxs)(t.h3,{id:"assertions-test_request_scripts-and-test_response_scripts",children:["Assertions (",(0,n.jsx)(t.code,{children:"test_request_scripts"})," and ",(0,n.jsx)(t.code,{children:"test_response_scripts"}),")"]}),"\n",(0,n.jsxs)(t.p,{children:["Assertions are used to validate that certain business conditions hold in a more\npowerful way than is possible using API schema validation. Where API schema\nvalidation can only validate the ",(0,n.jsx)(t.em,{children:"structure"})," of a message, assertions can be\nused to validate the ",(0,n.jsx)(t.em,{children:"content"}),". Assertions can be performed for any value in the\nheader, body or uri of the request or response. In a response, the ",(0,n.jsx)(t.code,{children:"status"}),"\nfield may also be used for assertions."]}),"\n",(0,n.jsxs)(t.p,{children:["Each request/response may have a number of assertions, and each assertion is\ndefined by a ",(0,n.jsx)(t.code,{children:"name"})," and a list of Laravel validation ",(0,n.jsx)(t.code,{children:"rules"}),". The key for each\nrule is a path to a field using 'dot' syntax within the request/response object.\nFor more information on the syntax of these rules, visit the\n",(0,n.jsx)(t.a,{href:"https://laravel.com/docs/7.x/validation#available-validataion-rules",children:"Laravel documentation site"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"In addition to the builtin Laravel validation rules, ITP defines a number of\ncustom validators targeting ILP Packets:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ilpPacketAmount"}),": Validates that the ILP packet contains the specified\namount. If no value is provided, the ",(0,n.jsx)(t.code,{children:"body.amount"})," field is used as a default."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ilpPacketExpiration"}),": Validates that the ILP packet contains the specified\nexpiration date. If no value is provided, the ",(0,n.jsx)(t.code,{children:"body.expiration"})," field is used\nas a default."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ilpPacketCondition"}),": Validates that the ILP packet contains the specified\ncondition field. If no value is provided, the ",(0,n.jsx)(t.code,{children:"body.condition"})," field is used\nas a default."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ilpPacketDestination"}),": Validates that the ILP packet contains the specified\ndestination."]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'test_request_scripts:\n  - name: Amounts and currencies are specified correctly\n    rules:\n      body.transferAmount.amount: "required|in:99"\n      body.transferAmount.currency: "required|regex:/^[A-Z]{3}/"\n      body.payeeReceiveAmount.amount: "required|in:100"\n      body.payeeReceiveAmount.currency: "required|regex:/^[A-Z]{3}/"\n      body.payeeFspCommission.amount: "required|in:1"\n      body.payeeFspCommission.currency: "required|regex:/^[A-Z]{3}/"\n  - name: ILP Packet is well-formed\n    rules:\n      body.ilpPacket:\n        - "required"\n        - "regex:/^[A-Za-z0-9-_]+[=]{0,2}$/"\n        - "ilpPacketAmount:99"\n        - "ilpPacketDestination:g.gh.msisdn.{{ env.PHONE }}"\n        - "ilpPacketCondition"\n        - "ilpPacketExpiration"\n  - name: Callback URL is specified\n    rules:\n      headers.x-callback-url.*: "required|url"\ntest_response_scripts:\n  - name: Transaction was successfully accepted\n    rules:\n      status: "required|in:200"\n'})}),"\n",(0,n.jsx)(t.h3,{id:"request-and-response-templates",children:"Request and Response Templates"}),"\n",(0,n.jsx)(t.p,{children:"Each test step is also defined by a template request and response. This is used\nby the platform to generate simulated traffic for the components which are not\nSUTs in a session. Additionally, the templates also provide documentation for\ntest platform users, to outline which data needs to be sent, or can be expected\nfrom other components during test execution."}),"\n",(0,n.jsxs)(t.p,{children:["A ",(0,n.jsx)(t.code,{children:"request"})," template is composed of the following fields:"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{children:"Example"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"method"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The HTTP method used to make the request."}),(0,n.jsxs)(t.td,{children:[(0,n.jsx)(t.code,{children:"GET"}),", ",(0,n.jsx)(t.code,{children:"POST"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"uri"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A path or URI used to make the request."}),(0,n.jsxs)(t.td,{children:[(0,n.jsx)(t.code,{children:"/quotes"}),", ",(0,n.jsx)(t.code,{children:"/parties/{{ env.PARTY }}"})]})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:["The following fields may be used in both a ",(0,n.jsx)(t.code,{children:"request"})," or ",(0,n.jsx)(t.code,{children:"response"})," template:"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{children:"Example"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"headers"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A list of headers to include in the request or response."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'[accept: "application/json"]'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"body"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A JSON payload for the request or response."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:'{amount: "1005", currency: "USD", ...}'})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"delay"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"How many seconds the simulator should delay before sending the request or response."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"5"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"jws"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Configuration options for verifying and generating JWS signature headers."}),(0,n.jsx)(t.td,{})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:["Finally, the following fields may only be used in a ",(0,n.jsx)(t.code,{children:"response"})," template:"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,n.jsx)(t.th,{children:"Example"})]})}),(0,n.jsx)(t.tbody,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"status"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The status code that will be used for a response."}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"200"})})]})})]}),"\n",(0,n.jsx)(t.h4,{id:"example-of-a-request-and-response",children:"Example of a request and response"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'test_steps:\n  - #...\n    request:\n      method: POST\n      uri: /transactions\n      headers:\n        accept: "application/json"\n        content-type: "application/json"\n        x-callback-url: "https://example.com/example"\n        x-date: "2000-01-01T00:00:00.000Z"\n      body:\n        amount: "1005"\n        currency: "USD"\n        type: "merchantpay"\n        debitParty:\n          - key: "msisdn"\n            value: "+33555123456"\n        creditParty:\n          - key: "msisdn"\n            value: "+33555789123"\n    response:\n      status: 400\n      headers:\n        x-date: "2000-01-01T00:00:00.000Z"\n        content-type: "application/json"\n'})}),"\n",(0,n.jsx)(t.h3,{id:"jws-signatures",children:"JWS Signatures"}),"\n",(0,n.jsxs)(t.p,{children:["The Interoperability Test Platform supports generation of JWS signatures by\nsimulators, and verification of JWS signatures sent by SUTs. Both are controlled\nby adding a ",(0,n.jsx)(t.code,{children:"jws"})," key to a test step request or response. The ",(0,n.jsx)(t.code,{children:"jws"}),'\nconfiguration object includes two files which should be uploaded to the session\nenvironment when the test case is executed - one for the public key (used to\nvalidate the JWS signature) and one for the private key (used to generate the\nJWS signature in simulators). Any normal environment variable may be used for\nthese fields (see "Template Variables" below).']}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"alg"})," (optional)"]}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The JWS algorithm to use. Available values are ",(0,n.jsx)(t.code,{children:"RS256"})," (default), ",(0,n.jsx)(t.code,{children:"RS384"}),", ",(0,n.jsx)(t.code,{children:"RS512"}),", ",(0,n.jsx)(t.code,{children:"HS256"}),", ",(0,n.jsx)(t.code,{children:"HS384"}),", ",(0,n.jsx)(t.code,{children:"HS512"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"key"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The private key used to generate a JWS signature"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"public_key"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The public key used to validate a JWS signature"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"protectedHeaders"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The request/response headers which will be included in the JWS signature"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"header"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The name of the header which will contain the JWS signature"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,n.jsx)(t.code,{children:"transform"})," (optional)"]}),(0,n.jsxs)(t.td,{style:{textAlign:"left"},children:["The name of an additional transformation to apply to the signature. The only available value currently is ",(0,n.jsx)(t.code,{children:"mojaloop"}),"."]})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:["The transform field exists because different implementations expect the JWS\nsignature in different formats. By default, the JWS signature will be directly\ninserted into the HTTP header. With the ",(0,n.jsx)(t.code,{children:"mojaloop"})," transform enabled, the\nsignature will be wrapped in a JSON object along with a ",(0,n.jsx)(t.code,{children:"protectedHeaders"}),"\nfield, and it is this object which is inserted into the HTTP header."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'test_steps:\n  - # ...\n    request:\n      # ...\n      jws:\n        alg: RS256\n        key: "{{ env.MMO_PRIVATE_KEY }}"\n        public_key: "{{ env.MMO_PUBLIC_KEY }}"\n        header: "FSPIOP-Signature"\n        transform: mojaloop\n        protectedHeaders:\n          - FSPIOP-URI\n          - FSPIOP-HTTP-Method\n          - FSPIOP-Source\n          - FSPIOP-Destination\n          - Date\n'})}),"\n",(0,n.jsx)(t.h2,{id:"repeating-requests",children:"Repeating Requests"}),"\n",(0,n.jsxs)(t.p,{children:['It is sometimes desirable to test scenarios where a particular step may be\nrepeated several times before proceeding. As an example, an API based on polling\nwould require a simulator to make several "poll" requests before the final\nanswer is provided. This can be achieved through the ',(0,n.jsx)(t.code,{children:"repeat"})," parameter of a\ntest step. ",(0,n.jsx)(t.code,{children:"repeat"})," is defined by the following parameters:"]}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Name"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"condition"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Responses returned to the platform will be compared against this condition. If the condition matches, the test run will repeat the request again"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"max"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The maximum number of times the repeat condition may hold before the test is considered a failure."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"response"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"A sample intermediate response which will be used by a simulator before moving on to the next step"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"count"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"The number of times a simulator should send the intermediate response before moving on to the next step"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:(0,n.jsx)(t.code,{children:"test_response_scripts"})}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Optionally, you may specify some assertions to apply against the intermediate responses."})]})]})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'- path: /get-status\n  pattern: "^get-status$"\n  method: GET\n  source: source-component\n  target: target-component\n  test_response_scripts:\n    - name: Transaction was successfully accepted\n      rules:\n        body.result: "SUCCESS"\n        status: "required|in:200"\n  request:\n    method: GET\n    uri: /get-status\n\n  # Final response, sent by a simulator after 2 occurrences\n  response:\n    status: 200\n    body:\n      result: "SUCCESS"\n\n  repeat:\n    # If a system responds to a simulated request with this body, we will repeat the request\n    condition:\n      body:\n        result: "PENDING"\n    # If the condition above holds more than 3 times, we will count it as a failure\n    max: 3\n    # Our simulator will send a "PENDING" response twice before sending "SUCCESS"\n    count: 2\n    response:\n      status: 202\n      body:\n        updatedTime: \'{{ "now" | date }}\'\n        result: "PENDING"\n    # We want to check that "PENDING" responses sent by a system are well-formed\n    test_response_scripts:\n      - name: Request was received\n        rules:\n          body.result: "required|in:PENDING"\n          status: "required|in:202"\n'})}),"\n",(0,n.jsx)(t.h2,{id:"template-variables",children:"Template variables"}),"\n",(0,n.jsx)(t.p,{children:"It is often useful to include dynamic data within a test case. Some examples of\nthis are:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"To send a simulated request with a freshly generated UUID on each test run"}),"\n",(0,n.jsx)(t.li,{children:"To include a field in a HTTP response which was dynamically provided in a\npreceding request"}),"\n",(0,n.jsx)(t.li,{children:"To customise the test execution for a particular environment (e.g. to include\na valid MSISDN registered within the SUT taking part in the test)"}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Template variables are a way to achieve the above by injecting values inside any\nstring within the ",(0,n.jsx)(t.code,{children:"test_steps[*].request"})," and ",(0,n.jsx)(t.code,{children:"test_steps[*].response"})," objects.\nIn addition, variables may be used inside the ",(0,n.jsx)(t.code,{children:"rules"})," field of\n",(0,n.jsx)(t.code,{children:"test_steps[*].test_request_scripts"})," and ",(0,n.jsx)(t.code,{children:"test_steps[*].test_response_scripts"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["The test platform uses the powerful templating language\n",(0,n.jsx)(t.a,{href:"https://twig.symfony.com/",children:"Twig"})," to allow sandboxed execution of arbitrary\nlogic within the test case context. This allows us to create templates with\nhighly dynamic data - such as including data from previous messages, or\ncombining multiple sources of data using arithmetic. The syntax for Twig\ntemplate variables is ",(0,n.jsx)(t.code,{children:"{{ twig_expression }}"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["A full description of the twig templating language is beyond the scope of this\ndocumentation, although a detailed reference is available on the\n",(0,n.jsx)(t.a,{href:"https://twig.symfony.com/doc/3.x/",children:"Twig website"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"Within a test case, the following context variables are available for use (in\naddition to all of Twig's built-in functions and variables):"}),"\n",(0,n.jsx)(t.h4,{id:"env",children:(0,n.jsx)(t.code,{children:"env"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"env"})," variable contains a reference to the variables defined within the\nsession when it is in execution. Two types of environment variable exist -\nstring variables and file variables. String variables will be replaced directly\ninside the twig template as strings, whereas file variables will be inserted as\na file path. File variables are useful for providing a reference to a public or\nprivate key in the ",(0,n.jsx)(t.code,{children:"jws"})," field of a test step."]}),"\n",(0,n.jsx)(t.p,{children:'Any legal Javascript variable name may be used for an environment variable, but\nthe convention is to use "UPPER_SNAKE_CASE". It is often useful to document the\nnames of any variables used within a test case in the test case preconditions,\nso that users of the test case can quickly verify that they have provided values\nfor all important variables to the test case.'}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'body:\n  fromParty:\n    msisdn: "{{ env.MMO1_PARTY_MSISDN }}"\n  toParty:\n    msisdn: "{{ env.MMO2_PARTY_MSISDN }}"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"steps",children:(0,n.jsx)(t.code,{children:"steps"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"steps"})," variable contains a reference to all previously executed test steps\nin the test case. In the following example, we use ",(0,n.jsx)(t.code,{children:"steps"})," in combination with\ntwig's ability to perform arithmetic to simulate a constant fee of 1 USD being\napplied to the amount requested in a previous step:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'body:\n  transferAmount:\n    currency: "USD"\n    amount: "{{ steps.7.request.body.amount.amount + 1 }}"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"uuidv4",children:(0,n.jsx)(t.code,{children:"uuidv4"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"uuidv4()"})," function can be used to generate a unique UUID for a request. It\ncan be used in conjunction with ",(0,n.jsx)(t.code,{children:"steps"})," as described above to correlate a UUID\nacross several steps:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'request:\n  # ...\n  body:\n    serverCorrelationId: "{{ uuidv4() }}"\nresponse:\n  # ...\n  body:\n    requestId: "{{ steps.4.request.body.serverCorrelationId }}"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"now",children:(0,n.jsx)(t.code,{children:'"now"'})}),"\n",(0,n.jsxs)(t.p,{children:["Parsing date-like strings such as ",(0,n.jsx)(t.code,{children:'"now"'})," is a builtin feature of Twig, but it\nis documented here separately as a useful tool in building test cases. Using\nTwig filters, you can format a date using any format string:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'headers:\n  X-Date: \'{{ "now" | date("F j, Y, g:i a") }}\'\n  X-Future-Date: \'{{ "+1 hour" | date("F j, Y, g:i a") }}\'\n'})}),"\n",(0,n.jsx)(t.h4,{id:"mapped_urls",children:(0,n.jsx)(t.code,{children:"mapped_urls"})}),"\n",(0,n.jsxs)(t.p,{children:["It is sometimes useful to be able to refer to a component by URL in a test\ncase - for example to generate a dynamic callback URL. This can be achieved with\nthe ",(0,n.jsx)(t.code,{children:"mapped_urls"})," variable. These will contain the same URLs that are displayed\nto the user during the session creation wizard."]}),"\n",(0,n.jsxs)(t.p,{children:["The format is ",(0,n.jsx)(t.code,{children:'mapped_urls["from-component-slug"]["to-component-slug"]'}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:'headers:\n  X-Callback-URL: \'{{ mapped_urls["mmo1"]["sp"] }}/callback\'\n  # If a slug is alphanumeric, it is possible to use dot syntax instead:\n  X-Error-Callback-URL: "{{ mapped_urls.mmo1.sp }}/error"\n'})}),"\n",(0,n.jsx)(t.h4,{id:"ilp-functions",children:"ILP Functions"}),"\n",(0,n.jsx)(t.p,{children:"In order to generate ILP variables, the following functions have been defined:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ilpFulfilment()"}),": Generates a value for the ILP fulfilment"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ilpCondition( fulfilment )"}),": Generates a condition based on a fulfilment"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"ilpPacket( amount, expires, condition, destination, data)"}),": Generates an ILP\npacket"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"base64_urlencode"}),": Applies a base64_url encoding"]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"base64_urldecode"}),": Decodes a base64_url encoded string"]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:'  body:\n    condition: \'{{ ilpCondition(ilpFulfilment())  | base64_urlencode }}\'\n    expiration: \'{{ "+1 hour" | date("Y-m-d\\\\TH:i:s.vP")}}\'\n    ilpPacket: \'{{\n        ilpPacket(\n          steps.6.request.body.amount.amount,\n          "+1 hour",\n          ilpCondition(ilpFulfilment()),\n          "g.gh.msisdn.#{steps.6.request.body.payee.partyIdInfo.partyIdentifier}",\n          ""\n        ) | base64_urlencode\n      }}\'\n'})})]})}function h(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},1151:function(e,t,s){s.d(t,{Z:function(){return a},a:function(){return r}});var n=s(7294);const i={},l=n.createContext(i);function r(e){const t=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(l.Provider,{value:t},e.children)}}}]);